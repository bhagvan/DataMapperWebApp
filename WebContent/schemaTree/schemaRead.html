<!DOCTYPE html>
<html>

    <head>
        <meta charset="UTF-8">
        <title>Schema to tree</title>
        <script src="../assets/lib/d3/d3.js"></script>
        <script src="../assets/lib/jQuery/jquery-3.1.0.js"></script>
        <script src="../assets/lib/jquery-ui-1.12.0.custom/jquery-ui.js"></script>
        <!--        <script src="../d3trials/assets/fileHandler.js"></script>-->
        <script src="assets/fileHandler.js"></script>
        <link rel="stylesheet" href="assets/d3dm_style.css">

        <style>
            .structure,.structure ul {
                list-style-type: none;
                text-indent: 5px;
            }
            li{
                border-bottom: 1px solid #c9c9c9;
                border-left: 1px solid #c9c9c9;
                width: max-content;
            }
        </style>

    </head>

    <body>


        <div id="file-load">
            <div class="file-load-container" id="input-file-load-container">
                <button id="load-input-btn">Load input</button>
                <button id="clear-input-btn">Clear input</button>

                <div class="load-file" id="load-input">
                    <input type="file" id="input-file-select" name="input-select[]" accept=".xml" />
                    <div class="file-drag" id="input-file-drag">or drop files here</div>
                </div>

            </div>


        </div>



        <div style="display:inline-block;">
            <ul id="input-structure" class="structure"  >

            </ul>
        </div>

        <div id="canvas-container">
            <svg class="canvas" width="1800" height="500">
            <g id="input-container" transform="translate(0,0)">

            <g id="input-container-fo" class="container-fo">
            <rect class="container-title-outline" id="input-container-title-outline" height="20" fill="#77C1C0" stroke="black"></rect>
            <text class="container-title" id="input-container-title" font-weight="bold">Input</text>
            </g>
            </g>


            <g id="output-container" transform="translate(0,0)">
            <g id="output-container-fo" class="container-fo">
            <rect class="container-title-outline" id="output-container-title-outline" height="20" fill="#E59CA5" stroke="black"></rect>
            <text class="container-title" id="output-container-title" font-weight="bold">Output</text>
            </g>

            </g>
            <g id="trial-container"></g>
            </svg>

        </div>



        <script>
            $(document).ready(function () {

                //display or hide the load file options
                d3.select("#load-output-btn").on("click", function () {
                    $("#load-output").slideToggle();
                });
                d3.select("#load-input-btn").on("click", function () {
                    $("#load-input").slideToggle();
                });


                if (window.File && window.FileList && window.FileReader) {
                    init("input-file-select", "input-file-drag", inputcontainer);
                    //init("output-file-select", "output-file-drag", outputcontainer);
                }
                parseJSONTree("ddd", "ddd");

            });


            var inputcontainer;

            function parseJSONTree(text, resultpane) {

//                var data = JSON.parse(text);
                var data = {
                    "title": "person",
                    "type": "object",
                    "properties": {
                        "first name": {
                            "type": "string"
                        },
                        "last name": {
                            "type": "string"
                        },
                        "age": {
                            "type": "number"
                        },
                        "birthday": {
                            "type": "string",
                            "format": "date-time"
                        },
                        "address": {
                            "type": "object",
                            "properties": {
                                "street address": {
                                    "type": "object",
                                    "properties": {
                                        "house number": {
                                            "type": "number"
                                        },
                                        "lane": {
                                            "type": "string"
                                        }
                                    }
                                },
                                "city": {
                                    "type": "string"
                                },
                                "state": {
                                    "type": "string"
                                },
                                "country": {
                                    "type": "string"
                                }
                            }
                        },
                        "phone number": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "location": {
                                        "type": "string"
                                    },
                                    "code": {
                                        "type": "number"
                                    }
                                },
                                "required": [
                                    "location",
                                    "code"
                                ]
                            }
                        },
                        "children": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        },
                        "nickname": {
                            "type": "string"
                        }
                    }
                };

                var title = data.title || "Root";
                var result = d3.select("#trial-container");
                var result1 = d3.select("#input-structure");

                var elementcount=traverseJSONSchema1(data, title, result1, 0, 0);
                console.log(elementcount);
                //    traverseJSONSchema(data, title, result);
            }
            function traverseJSONSchema(root, rootname, resultpane) {
                console.log(resultpane.attr("x"));
                if (root.type === "object") {
                    var listitem = resultpane.append("g");
                    listitem.append("text").text(rootname + ":" + root.type);
                    var newlist = listitem.append("g");
                    var items = root.properties; //select PROPERTIES
                    for (var i = 0; i < Object.keys(items).length; i++) {   //traverse through each PROPERTY of the object
                        var itemname = Object.keys(items)[i];
                        var item = items[itemname];
                        traverseJSONSchema(item, itemname, newlist);
                    }

                } else if (root.type === "array") {

                    var items = root.items; //select ITEMS
                    var listitem = resultpane.append("g");
                    listitem.append("text").text(rootname + ":" + root.type + "[" + items.type + "]");
                    traverseJSONSchema(items, "", listitem);  //recurse through the items of array

                } else if (["string", "integer", "number", "boolean"].indexOf(root.type) > -1) {    //when the type is a primitive

                    resultpane.append("text").text(rootname + ":" + root.type);
                }
            }


            function traverseJSONSchema1(root, rootname, resultpane, ccc, rank) {

                if (root.type === "object") {
                    var listitem = resultpane.append("li");
                    if (rootname !== "") {
                        listitem.text(rootname + ":" + root.type + "-" + ccc + "-" + rank);
                        rank++;
                        ccc++;
                    }
                    var newlist = listitem.append("ul");
                    var items = root.properties; //select PROPERTIES
                    var templev = 0;
                    for (var i = 0; i < Object.keys(items).length; i++) {   //traverse through each PROPERTY of the object
                        var itemname = Object.keys(items)[i];
                        var item = items[itemname];
                        ccc = traverseJSONSchema1(item, itemname, newlist, ccc, rank);
                    }

                } else if (root.type === "array") {
                    var items = root.items; //select ITEMS
                    var listitem = resultpane.append("li");
                    if (rootname !== "") {
                        listitem.text(rootname + ":" + root.type + "[" + items.type + "]" + "-" + ccc + "-" + rank);
                        rank++;
                        ccc++;
                    }

                    ccc=traverseJSONSchema1(items, "", listitem, ccc, rank);  //recurse through the items of array
                } else if (["string", "integer", "number", "boolean"].indexOf(root.type) > -1) {    //when the type is a primitive
                    var listitem = resultpane.append("li");
                    if (rootname !== "") {
                        listitem.text(rootname + ":" + root.type + "-" + ccc + "-" + rank);
                        rank++;
                        ccc++;
                    }
                }

                return ccc;
            }

            function drawNode(parent, text, dotposition, x, y, height, width) {
                var parent1 = parent.append("g").attr("class", "node-element")
                        .attr("height", height)
                        .attr("width", width);
                parent1.append("text").attr("class", "node-element-text")
                        .attr("x", x)
                        .attr("y", y + (3 * height / 4))
                        .text(text);
                parent1.append("circle").attr("class", "drag-dot")
                        .attr("r", height / 4)
                        .attr("cx", function () {
                            return (dotposition === "LEFT" ? x : x + width);
                        })
                        .attr("cy", y + (height / 2))
                        .attr("fill", "rgb(0,0,0)");
            }

        </script>


    </body>

</html>