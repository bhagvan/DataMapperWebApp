<!DOCTYPE html>
<html>

    <head>
        <meta charset="UTF-8">
        <title>Schema to tree</title>
        <script src="../assets/lib/d3/d3.js"></script>
        <script src="../assets/lib/jQuery/jquery-3.1.0.js"></script>
        <script src="../assets/lib/jquery-ui-1.12.0.custom/jquery-ui.js"></script>
        <script src="assets/fileHandler.js"></script>
      
        <style>
            .structure,.structure ul {
                list-style-type: none;
                text-indent: 5px;
            }
            li{
                border-bottom: 1px solid #c9c9c9;
                border-left: 1px solid #c9c9c9;
                width: max-content;
            }
        </style>

    </head>

    <body>
        <div id="file-load">
            <div class="file-load-container" id="input-file-load-container">
                <button id="load-input-btn">Load input</button>
                <button id="clear-input-btn">Clear input</button>

                <div class="load-file" id="load-input">
                    <input type="file" id="input-file-select" name="input-select[]" accept=".json" />
                    <div class="file-drag" id="input-file-drag">or drop files here</div>
                </div>

            </div>

        </div>
        <hr>
        <div style="display:inline-block;">
            <ul id="input-structure" class="structure"  >

            </ul>
        </div>


        <script>
            $(document).ready(function () {


                if (window.File && window.FileList && window.FileReader) {
                    init("input-file-select", "input-file-drag", inputcontainer);
                }

            });

            var inputcontainer;

            function parseJSONTree(text, resultpane) {
                var data = JSON.parse(text);
                var title = data.title || "Root";
                var result = d3.select("#input-structure");
                traverseJSONSchema(data, title, result);

            }

            function traverseJSONSchema(root, rootname, resultpane) { 
                if (root.type === "object") {
                    var listitem = resultpane.append("li").text(rootname + ":<obj>");
                    var newlist = listitem.append("ul");

                    var items = root.properties;
                    for (var i = 0; i < Object.keys(items).length; i++) {
                        var itemname = Object.keys(items)[i];
                        var item = items[itemname];
                        var title = itemname;

                        traverseJSONSchema(item, itemname, newlist);
                    }

                } else if (root.type === "array") {
                    resultpane.append("li").text(rootname + ":[arr]");
                    var items = root.items;
                    traverseJSONSchema(items, "", resultpane);


                } else {
                    resultpane.append("li").text(rootname + ":" + root.type);
                }
            }


        </script>


    </body>

</html>