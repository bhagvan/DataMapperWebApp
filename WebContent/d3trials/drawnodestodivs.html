<!DOCTYPE html>
<html>

    <head>
        <meta charset="UTF-8">
            <title>Data Mapper Tool</title>
            <script src="../assets/lib/d3/d3.js"></script>
            <script src="../assets/lib/jQuery/jquery-3.1.0.js"></script>
            <script src="../assets/lib/jquery-ui-1.12.0.custom/jquery-ui.js"></script>
            <link rel="stylesheet" href="assets/d3dm_style.css">

                </head>

                <body>


                    <div id="page-body">

                        <div  id="file-load">
                            <div class="file-load-container" id="input-file-load-container">
                                <button id="load-input-btn">Load input</button>

                                <div class="load-file" id="load-input">
                                    <input type="file" id="input-file-select" name="input-select[]" accept=".xml" />
                                    <div class="file-drag" id="input-file-drag">or drop files here</div>
                                </div>

                            </div>

                            <div class="file-load-container" id="output-file-load-container">
                                <button id="load-output-btn">Load output</button>

                                <div class="load-file" id="load-output">
                                    <input type="file" id="output-file-select" name="output-select[]" accept=".xml" />
                                    <div class="file-drag" id="output-file-drag">or drop files here</div>
                                </div>

                            </div>
                        </div>


                        <div id="canvas-container">
                            <svg class="canvas" >
                                <g  id="input-container">  

                                    <foreignObject x="10" y="10" width="200" height="400" id="input-container-fo" class="container-fo">
                                        <div xmlns="http://www.w3.org/1999/xhtml" id="output-container-div" class="container-div">
                                            <div class="container-div-title" id="input-container-div-title">Input</div>

                                        </div>
                                    </foreignObject>
                                </g>


                                <g id="output-container">
                                    <foreignObject  x="700"  y="10" width="200" height="400" id="output-container-fo" class="container-fo">
                                        <div xmlns="http://www.w3.org/1999/xhtml" id="output-container-div" class="container-div">
                                            <div class="container-div-title" id="output-container-div-title">Output</div>

                                        </div>
                                    </foreignObject>

                                </g>
                            </svg>

                        </div>





                    </div>
                    <p id="trial" onclick="getPos()"></p>


                    <!--<script src="assets/elementSketcher.js"></script>-->
                    <script src="assets/d3TreeStructure.js"></script>
                    <script src="assets/fileHandler.js"></script>

                    <script>

                        var colorcode = ["#cccccc", "#999999", "#666666", "#000000"];
                        var inputs = [],
                                outputs = [],
                                inputleaves = [],
                                outputleaves = [];


                        var elementwidth = 120,
                                elementheight = 30,
                                inputstartx = 30,
                                inputstarty = 50,
                                outputstartx = inputstartx + 500,
                                outputstarty = inputstarty;

                        var verticalmargin = 2;

                        var canvas = d3.select(".canvas"),
                                inputcontainer = d3.select("#input-container"),
                                outputcontainer = d3.select("#output-container");

                        inputcontainer.append("g").attr("id", function (d) {
                            return inputcontainer.attr("id") + "-1";
                        });
                        outputcontainer.append("g").attr("id", function (d) {
                            return outputcontainer.attr("id") + "-1";
                        });
                        canvas.append("g").attr("id", function (d) {
                            return inputcontainer.attr("id") + "-2";
                        });
                        canvas.append("g").attr("id", function (d) {
                            return outputcontainer.attr("id") + "-2";
                        });

                        //update input output containers
                        var inputfo = d3.select("#input-container-fo")
                                .attr("x", inputstartx)
                                .attr("y", inputstarty)
                                .attr("width", elementwidth + 100);

                        var outputfo = d3.select("#output-container-fo")
                                .attr("x", outputstartx)
                                .attr("y", outputstarty)
                                .attr("width", elementwidth + 100);


                        var inputoutline = inputcontainer.append("rect")
                                .attr("x", inputstartx)
                                .attr("y", inputstarty)
                                .attr("width", elementwidth + 100)
                                .attr("height", 200)
                                .attr("stroke", "black")
                                .attr("fill", "none")
                                .attr("stroke-width", "1");

                        var outputoutline = outputcontainer.append("rect")
                                .attr("x", outputstartx)
                                .attr("y", outputstarty)
                                .attr("width", elementwidth + 100)
                                .attr("height", 200)
                                .attr("stroke", "black")
                                .attr("fill", "none")
                                .attr("stroke-width", "1");

                        function updateContainers() {
                            var maxinlev = 0, maxoutlev = 0;
                            for (var i = 0; i < inputs.length; i++) {
                                if (maxinlev < inputs[i].level) {
                                    maxinlev = inputs[i].level;
                                }
                            }
                            for (var i = 0; i < outputs.length; i++) {
                                if (maxoutlev < outputs[i].level) {
                                    maxoutlev = outputs[i].level;
                                }
                            }
                            var inw = elementwidth + 20 + (maxinlev * 20);
                            var inh = 50 + (elementheight * inputs.length);
                            var outw = elementwidth + 20 + (maxoutlev * 20);
                            var outh = 50 + (elementheight * outputs.length);

                            if (inputs.length !== 0) {
                                inputfo.attr("width", inw)
                                        .attr("height", inh)
                                        .attr("x", inputs[0].x - 5);
                                inputoutline.attr("width", inw)
                                        .attr("height", inh)
                                        .attr("x", inputs[0].x - 5);
                            }
                            if (outputs.length !== 0) {
                                outputfo.attr("width", outw)
                                        .attr("height", outh)
                                        .attr("x", outputs[0].x - 5);
                                outputoutline.attr("width", outw)
                                        .attr("height", outh)
                                        .attr("x", outputs[0].x - 5);
                            }

                        }

                        $(document).ready(function () {
                            //display or hide the load file options
                            $("#load-output-btn").click(function () {
                                $("#load-output").slideToggle();
                            });

                            $("#load-input-btn").click(function () {
                                $("#load-input").slideToggle();
                            });


                            if (window.File && window.FileList && window.FileReader) {
                                init("input-file-select", "input-file-drag", inputcontainer);
                                init("output-file-select", "output-file-drag", outputcontainer);
                            }

                        });





                    </script>
                </body>

                </html>