<!DOCTYPE html>
<html>

    <head>
        <meta charset="UTF-8">
        <title>D3 line drawings</title>
        <script src="../assets/lib/d3/d3.js"></script>
        <!--<script src="https://d3js.org/d3.v4.min.js"></script>-->

        <style>
            .input-container{
                padding: 10px;
                margin: 50px;
                width:60%;
                border: 1px solid red;
            }
            .input-container div{
                margin: auto;
                display: inline-block;
            }
            .in-icon{
                float: right;

            }

            .canvas{
                border:1px solid black;
            }
        </style>
    </head>

    <body>

        <a href="https://www.dashingd3js.com/svg-paths-and-d3js">Source tutorial</a><br><br>


        <svg class="canvas" width="1000" height="500">
        <g  id="input-container">  </g>
        <g id="output-container"> </g>
        </svg>


        <div >

            <button type="button" onclick="addInput()">Add input node</button>
            <button type="button" onclick="addOutput()">Add output node</button>
        </div>



        <p id="trial"></p>

        <script>



            var inputs = [{"text": "inleaf1", "col": "red"}, {"text": "inleaf2", "col": "blue"}, {"text": "inleaf3", "col": "green"}];
            var outputs = [{"text": "outleaf1", "col": "blue"}, {"text": "outleaf2", "col": "red"}, {"text": "outleaf3", "col": "green"}];

            var elementwidth = 120;
            var elementheight = 50;
            var inputstartx = 20;
            var inputstarty = 20;
            var outputstartx = 700;
            var outputstarty = 20;

            var verticalmargin = 20;

            var canvas = d3.select(".canvas");
            var inputcontainer = d3.select("#input-container");
            var outputcontainer = d3.select("#output-container");

            canvas.append("g").attr("id", function (d) {
                return inputcontainer.attr("id") + "-2";
            });
            canvas.append("g").attr("id", function (d) {
                return outputcontainer.attr("id") + "-2";
            })

            function drawNodes(container, elementwidth, elementheight, startX, startY, verticalmargin, data, dotposition) {
                var coordinates, dragdot2, dragline;
                var childcontainer = d3.select("#" + (container.attr("id") + "-2"));
                if (dotposition === "RIGHT") {
                    var dotpositionABS = startX + elementwidth;
                } else if (dotposition === "LEFT") {
                    var dotpositionABS = startX;
                }
                var dragme = d3.drag()
                        .on("start", function (d) {
                            var thisdragY = d3.select(this).attr("cy");
                            var thisdragX = d3.select(this).attr("cx");
                            var thisdragR = d3.select(this).attr("r");
                            var xx = 0;
                            var yy = 0;
                            coordinates = [0, 0];
                            dragdot2 = childcontainer.append("circle")
                                    .attr("cx", thisdragX)
                                    .attr("cy", thisdragY)
                                    .attr("r", thisdragR)
                                    .attr("fill", "black");
                            dragline = childcontainer.append("line")
                                    .attr("x1", thisdragX)
                                    .attr("x2", thisdragX)
                                    .attr("y1", thisdragY)
                                    .attr("y2", thisdragY)
                                    .style("stroke", d.col)
                                    .style("stroke-width", "2");
                        })
                        .on("drag", function (d) {
                            coordinates = d3.mouse(this);
                            xx = coordinates[0];
                            yy = coordinates[1];
                            dragline.attr("x2", xx).attr("y2", yy);
                            dragdot2.attr("cx", xx).attr("cy", yy);

                            //if position is inside the outleafs - stroke color change
                        })
                        .on("end", function (d) {
                            // d3.select(".coors").text(xx + "-" + yy);
                            //if position is inside the outleafs - set position to the left of the rect
                        });



                var inputleaf = container.selectAll("rect")
                        .data(data)
                        .enter().append("rect")
                        .attr("class", "input-leaf")
                        .attr("width", elementwidth)
                        .attr("height", elementheight)
                        .attr("x", startX)
                        .attr("y", function (d, i) {
                            return startY + ((elementheight + verticalmargin) * i);
                        })
                        .attr("stroke-width", "2")
                        .attr("fill", "none")
                        .attr("stroke", function (d) {
                            return d.col;
                        });

                var inputtext = container.selectAll("text")
                        .data(data)
                        .enter().append("text")
                        .attr("x", startX + elementwidth / 10)
                        .attr("y", function (d, i) {
                            return startY + (elementheight / 2) + ((elementheight + verticalmargin) * i);
                        })
                        .text(function (d) {
                            return d.text;
                        });




                var inputdragdot = container.selectAll("circle")
                        .data(data)
                        .enter().append("circle").attr("r", elementheight / 4)
                        .attr("cx", function (d) {
                            return dotpositionABS;
                        })
                        .attr("cy", function (d, i) {
                            return startY + (elementheight / 2) + ((elementheight + verticalmargin) * i);
                        })
                        .attr("r", function () {
                            return elementheight / 4;
                        })
                        .attr("fill", "black")
                        .call(dragme);

            }



            drawNodes(inputcontainer, elementwidth, elementheight, inputstartx, inputstarty, verticalmargin, inputs, "RIGHT");
            drawNodes(outputcontainer, elementwidth, elementheight, outputstartx, outputstarty, verticalmargin, outputs, "LEFT");

            function addInput() {
                inputs.push({"text": "newelement", "col": "red"});
                drawNodes(inputcontainer, elementwidth, elementheight, inputstartx, inputstarty, verticalmargin, inputs, "RIGHT");
            }
            function addOutput() {
                outputs.push({"text": "newelement", "col": "red"});
                drawNodes(outputcontainer, elementwidth, elementheight, outputstartx, outputstarty, verticalmargin, outputs, "LEFT");
            }
            // dragdot1.call(dragme);

        </script>


    </body>

</html>